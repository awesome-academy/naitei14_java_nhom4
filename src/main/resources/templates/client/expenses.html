<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{fragments/layout :: layout(~{::body})}">


<body>
<link rel="stylesheet" th:href="@{/css/expenses.css}">
<div class="container">

    <!-- Header Section -->
    <div class="header-section">
        <h2>ÔøΩ Qu·∫£n l√Ω Chi ti√™u</h2>
        <a th:href="@{/expenses/add}" class="btn-add-expense">
            <span>‚ûï</span> Th√™m chi ti√™u m·ªõi
        </a>
    </div>

    <!-- Stats Cards -->
    <div class="stats-grid">
        <div class="stat-card total">
            <div class="stat-info">
                <h3>T·ªïng chi ti√™u</h3>
                <div class="stat-value" th:text="${totalExpenses}">0</div>
                <small style="color: #9ca3af;">kho·∫£n</small>
            </div>
            <div class="stat-icon">üìä</div>
        </div>

        <div class="stat-card amount">
            <div class="stat-info">
                <h3>T·ªïng s·ªë ti·ªÅn</h3>
                <div class="stat-value" style="font-size: 1.5rem; color: #ef4444;"
                     th:text="${totalAmount}">0 ‚Ç´</div>
                <small style="color: #9ca3af;">VNƒê</small>
            </div>
            <div class="stat-icon">üí∏</div>
        </div>

        <div class="stat-card average">
            <div class="stat-info">
                <h3>Trung b√¨nh</h3>
                <div class="stat-value" style="font-size: 1.5rem; color: #8b5cf6;"
                     th:text="${averageAmount}">0 ‚Ç´</div>
                <small style="color: #9ca3af;">m·ªói kho·∫£n</small>
            </div>
            <div class="stat-icon">üìà</div>
        </div>
    </div>

    <!-- Filters Card -->
    <div class="filters-card">
        <h3 class="filters-title">üîç T√¨m ki·∫øm & L·ªçc</h3>
        <form method="get" th:action="@{/expenses}">
            <div class="filters">
                <input type="text" name="keyword" placeholder="üîé T√¨m theo t√™n..." th:value="${keyword}" />

                <input type="date" name="from" th:value="${from}" />

                <select name="categoryId">
                    <option value="">üìÅ T·∫•t c·∫£ danh m·ª•c</option>
                    <option th:each="c : ${categories}"
                            th:value="${c.id}"
                            th:text="${c.name}"
                            th:selected="${c.id == categoryId}">
                    </option>
                </select>

                <input type="number" name="min" placeholder="üíµ S·ªë ti·ªÅn t·ªëi thi·ªÉu" th:value="${min}" />
            </div>

            <div class="filter-actions">
                <button type="submit" class="btn-filter">L·ªçc k·∫øt qu·∫£</button>
                <button type="reset" class="btn-reset" onclick="window.location.href='/expenses'">X√≥a b·ªô l·ªçc</button>
            </div>
        </form>
    </div>

    <!-- Table Card -->
    <div class="table-card">
        <div class="table-responsive">
            <table>
                <thead>
                <tr>
                    <th>ÔøΩ T√™n chi ti√™u</th>
                    <th>ÔøΩ S·ªë ti·ªÅn</th>
                    <th>ÔøΩ Ng√†y</th>
                    <th>ÔøΩ Danh m·ª•c</th>
                    <th>üìé ƒê√≠nh k√®m</th>
                </tr>
                </thead>
                <tbody>
                <tr th:if="${#lists.isEmpty(expenses)}">
                    <td colspan="5">
                        <div class="empty-state">
                            <div class="empty-state-icon">üì≠</div>
                            <h3>Ch∆∞a c√≥ chi ti√™u n√†o</h3>
                            <p>B·∫Øt ƒë·∫ßu th√™m chi ti√™u ƒë·∫ßu ti√™n c·ªßa b·∫°n</p>
                        </div>
                    </td>
                </tr>

                <tr th:each="e : ${expenses}"
                    th:onclick="|window.location='/expenses/' + ${e.id}|">
                    <td><strong th:text="${e.name}"></strong></td>
                    <td class="amount-cell" th:text="${e.amount}"></td>
                    <td th:text="${#temporals.format(e.expenseDate, 'dd/MM/yyyy')}"></td>

                    <td>
                        <span class="category-badge"
                              th:classappend="${'category-' + #strings.toLowerCase(e.category.name)}"
                              th:text="${e.category.name}">
                        </span>
                    </td>

                    <td class="attachment-icon">
                        <span th:if="${e.attachment != null}">üìé</span>
                        <span th:unless="${e.attachment != null}" style="color: #d1d5db;">‚ûñ</span>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>

        <!-- Pagination -->
        <div class="pagination" th:if="${totalPages > 1}">
            <a th:if="${currentPage > 0}"
               th:href="@{/expenses(page=${currentPage - 1}, keyword=${keyword}, from=${from}, to=${to}, categoryId=${categoryId}, min=${min}, max=${max})}">
                ‚¨Ö Trang tr∆∞·ªõc
            </a>

            <span>Trang <strong th:text="${currentPage + 1}"></strong> /
                <strong th:text="${totalPages}"></strong></span>

            <a th:if="${currentPage < totalPages - 1}"
               th:href="@{/expenses(page=${currentPage + 1}, keyword=${keyword}, from=${from}, to=${to}, categoryId=${categoryId}, min=${min}, max=${max})}">
                Trang sau ‚û°
            </a>
        </div>

    </div>
</div>

</body>
</html>
